# RAG ì‹œìŠ¤í…œ êµ¬ì¶• ì™„ë£Œ âœ…

## ğŸ‰ êµ¬ì¶• ì™„ë£Œ!

RAG(Retrieval-Augmented Generation) ê¸°ë°˜ ë¬¸ì„œ ì²˜ë¦¬ ë° ì§ˆì˜ì‘ë‹µ ì‹œìŠ¤í…œì´ ì„±ê³µì ìœ¼ë¡œ êµ¬ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ“¦ ìƒì„±ëœ íŒŒì¼ ëª©ë¡

### 1. í•µì‹¬ ëª¨ë“ˆ (9ê°œ íŒŒì¼)
```
backend/app/domain/rag/
â”œâ”€â”€ __init__.py                 # ëª¨ë“ˆ export
â”œâ”€â”€ config.py                   # RAG ì „ìš© ì„¤ì • (ë…ë¦½ì )
â”œâ”€â”€ schemas.py                  # Pydantic ìŠ¤í‚¤ë§ˆ
â”œâ”€â”€ pdf_processor.py            # PDF ì²˜ë¦¬ (PyMuPDF + pdfplumber)
â”œâ”€â”€ document_converter.py       # ë§ˆí¬ë‹¤ìš´ ë³€í™˜ ë° ì²­í‚¹ (LangChain)
â”œâ”€â”€ vector_store.py             # ì„ë² ë”© ë° ë²¡í„° ì €ì¥ (KoSentenceBERT + ChromaDB)
â”œâ”€â”€ retriever.py                # RAG ê²€ìƒ‰ ë° ë‹µë³€ ìƒì„± (OpenAI GPT-4o)
â”œâ”€â”€ cli.py                      # CLI ì¸í„°í˜ì´ìŠ¤
â””â”€â”€ USAGE_GUIDE.md             # ìƒì„¸ ì‚¬ìš© ê°€ì´ë“œ
```

### 2. API ì—”ë“œí¬ì¸íŠ¸ (1ê°œ íŒŒì¼)
```
backend/app/api/v1/endpoints/
â””â”€â”€ rag.py                      # FastAPI ì—”ë“œí¬ì¸íŠ¸
```

### 3. ë°ì´í„° ë””ë ‰í† ë¦¬
```
backend/internal_docs/
â”œâ”€â”€ uploads/                    # ì—…ë¡œë“œëœ PDF íŒŒì¼
â”œâ”€â”€ processed/                  # ì²˜ë¦¬ëœ JSON íŒŒì¼
â””â”€â”€ chroma/                     # ChromaDB ë²¡í„° ì €ì¥ì†Œ
```

### 4. ë¬¸ì„œ ë° ì„¤ì • (4ê°œ íŒŒì¼)
```
backend/
â”œâ”€â”€ rag_requirements.txt        # ì¶”ê°€ íŒ¨í‚¤ì§€ ëª©ë¡
â”œâ”€â”€ RAG_README.md              # RAG ì‹œìŠ¤í…œ README
â”œâ”€â”€ test_rag.py                # ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ (í”„ë¡œì íŠ¸ ë£¨íŠ¸) RAG_INTEGRATION_GUIDE.md  # í†µí•© ê°€ì´ë“œ
```

**ì´ 15ê°œ íŒŒì¼ ìƒì„± + 3ê°œ ë””ë ‰í† ë¦¬ ìƒì„±**

## ğŸš€ ë¹ ë¥¸ ì‹œì‘ (3ë‹¨ê³„)

### 1ë‹¨ê³„: íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
cd Virtual-Assistant/backend
pip install -r rag_requirements.txt
```

### 2ë‹¨ê³„: í™˜ê²½ë³€ìˆ˜ ì„¤ì •
`.env` íŒŒì¼ì— ì¶”ê°€:
```env
OPENAI_API_KEY=your_openai_api_key_here
```

### 3ë‹¨ê³„: í…ŒìŠ¤íŠ¸
```bash
# ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
python test_rag.py

# PDF ì—…ë¡œë“œ
python -m app.domain.rag.cli upload "ê²½ë¡œ/ë¬¸ì„œ.pdf"

# ì§ˆì˜ì‘ë‹µ
python -m app.domain.rag.cli query
```

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### âœ… PDF ì²˜ë¦¬
- **PyMuPDF**: í…ìŠ¤íŠ¸ ë° ì´ë¯¸ì§€ ì¶”ì¶œ
- **pdfplumber**: í‘œ êµ¬ì¡° ì¸ì‹ ë° JSON ë³€í™˜
- **GPT-4 Vision**: ì´ë¯¸ì§€/ì°¨íŠ¸ ì„¤ëª… ìƒì„±
- **ì²˜ë¦¬ ê²°ê³¼ ì €ì¥**: JSON í˜•ì‹ìœ¼ë¡œ `internal_docs/processed/` ì €ì¥

### âœ… ë¬¸ì„œ ë³€í™˜ ë° ì²­í‚¹
- **ë§ˆí¬ë‹¤ìš´ ë³€í™˜**: êµ¬ì¡°í™”ëœ ë¬¸ì„œ í˜•ì‹
- **ì‹œë§¨í‹± ì²­í‚¹**: LangChain ê¸°ë°˜, ì˜ë¯¸ ë‹¨ìœ„ ë¶„í• 
- **ì²­í¬ í¬ê¸°**: 300~500 í† í° (ìµœì í™”)
- **ì˜¤ë²„ë©**: 50 í† í° (ë¬¸ë§¥ ìœ ì§€)

### âœ… ì„ë² ë”© ë° ì €ì¥
- **KoSentenceBERT**: í•œêµ­ì–´ íŠ¹í™” ì„ë² ë”© ëª¨ë¸
- **ChromaDB**: ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤
- **ë©”íƒ€ë°ì´í„°**: íŒŒì¼ëª…, í˜ì´ì§€, ì»¨í…ì¸  íƒ€ì… ê´€ë¦¬

### âœ… RAG ê²€ìƒ‰ ë° ë‹µë³€
- **ìœ ì‚¬ë„ ê²€ìƒ‰**: Top-K (ê¸°ë³¸ 3ê°œ) ë¬¸ì„œ ê²€ìƒ‰
- **ì»¨í…ìŠ¤íŠ¸ ìƒì„±**: ê´€ë ¨ ë¬¸ì„œë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ êµ¬ì„±
- **ë‹µë³€ ìƒì„±**: OpenAI GPT-4oë¡œ ì •í™•í•œ ë‹µë³€
- **ì°¸ê³  ë¬¸ì„œ ì œê³µ**: ë‹µë³€ ê·¼ê±° ì œì‹œ

### âœ… CLI ì¸í„°í˜ì´ìŠ¤
- **upload**: PDF ì—…ë¡œë“œ ë° ì²˜ë¦¬
- **query**: ëŒ€í™”í˜•/ë‹¨ì¼ ì§ˆì˜ì‘ë‹µ
- **stats**: ì‹œìŠ¤í…œ í†µê³„ ì¶œë ¥
- **Rich UI**: ì•„ë¦„ë‹¤ìš´ í„°ë¯¸ë„ UI

### âœ… API ì—”ë“œí¬ì¸íŠ¸
- `POST /api/v1/rag/upload`: PDF ì—…ë¡œë“œ
- `POST /api/v1/rag/query`: ì§ˆì˜ì‘ë‹µ
- `GET /api/v1/rag/stats`: í†µê³„ ì¡°íšŒ
- `DELETE /api/v1/rag/document/{id}`: ë¬¸ì„œ ì‚­ì œ
- `POST /api/v1/rag/reset`: ì»¬ë ‰ì…˜ ì´ˆê¸°í™”

## ğŸ“Š ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ì„±ìš”ì†Œ | ê¸°ìˆ  | ìš©ë„ |
|---------|------|------|
| PDF íŒŒì‹± | PyMuPDF, pdfplumber | í…ìŠ¤íŠ¸/í‘œ/ì´ë¯¸ì§€ ì¶”ì¶œ |
| ì´ë¯¸ì§€ ë¶„ì„ | OpenAI GPT-4 Vision | ì°¨íŠ¸/ê·¸ë˜í”„ ì„¤ëª… |
| ë¬¸ì„œ ë³€í™˜ | LangChain | ë§ˆí¬ë‹¤ìš´ ë³€í™˜ ë° ì²­í‚¹ |
| ì„ë² ë”© | KoSentenceBERT | í•œêµ­ì–´ ë²¡í„° ìƒì„± |
| ë²¡í„° DB | ChromaDB | ë²¡í„° ì €ì¥ ë° ê²€ìƒ‰ |
| LLM | OpenAI GPT-4o | ë‹µë³€ ìƒì„± |
| CLI UI | Rich | í„°ë¯¸ë„ ì¸í„°í˜ì´ìŠ¤ |
| API | FastAPI | REST API |

## ğŸ”„ ì²˜ë¦¬ íë¦„

### PDF â†’ ë²¡í„°DB
```
PDF íŒŒì¼
  â†“
[1ë‹¨ê³„] PDF íŒŒì‹±
  â”œâ”€ í…ìŠ¤íŠ¸ ì¶”ì¶œ (PyMuPDF)
  â”œâ”€ í‘œ ì¶”ì¶œ â†’ JSON (pdfplumber)
  â””â”€ ì´ë¯¸ì§€ ì¶”ì¶œ â†’ ì„¤ëª… ìƒì„± (GPT-4 Vision)
  â†“
[2ë‹¨ê³„] ë¬¸ì„œ ë³€í™˜
  â”œâ”€ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ ë³€í™˜
  â””â”€ ì‹œë§¨í‹± ì²­í‚¹ (300~500 í† í°)
  â†“
[3ë‹¨ê³„] ì„ë² ë”©
  â””â”€ í•œêµ­ì–´ ë²¡í„° ìƒì„± (KoSentenceBERT)
  â†“
[4ë‹¨ê³„] ì €ì¥
  â”œâ”€ ChromaDBì— ë²¡í„° ì €ì¥
  â””â”€ JSON íŒŒì¼ ì €ì¥ (internal_docs/processed/)
```

### ì§ˆì˜ì‘ë‹µ
```
ì‚¬ìš©ì ì§ˆë¬¸
  â†“
[1ë‹¨ê³„] ì§ˆë¬¸ ì„ë² ë”©
  â””â”€ ë²¡í„° ìƒì„± (KoSentenceBERT)
  â†“
[2ë‹¨ê³„] ìœ ì‚¬ë„ ê²€ìƒ‰
  â””â”€ ChromaDBì—ì„œ Top-K ê²€ìƒ‰
  â†“
[3ë‹¨ê³„] ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
  â””â”€ ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì •ë¦¬
  â†“
[4ë‹¨ê³„] ë‹µë³€ ìƒì„±
  â””â”€ GPT-4oë¡œ ë‹µë³€ ìƒì„±
  â†“
[5ë‹¨ê³„] ê²°ê³¼ ë°˜í™˜
  â”œâ”€ ë‹µë³€
  â”œâ”€ ì°¸ê³  ë¬¸ì„œ
  â””â”€ ì²˜ë¦¬ ì‹œê°„
```

## ğŸ“– ì‚¬ìš© ì˜ˆì‹œ

### CLI ì‚¬ìš©
```bash
# PDF ì—…ë¡œë“œ
$ python -m app.domain.rag.cli upload manual.pdf

ì²˜ë¦¬ ê²°ê³¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ í•­ëª©          â”ƒ ê°’       â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”©
â”‚ íŒŒì¼ëª…        â”‚ manual.pdfâ”‚
â”‚ ì´ í˜ì´ì§€     â”‚ 50       â”‚
â”‚ ìƒì„±ëœ ì²­í¬   â”‚ 120      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ“ ë¬¸ì„œ ì²˜ë¦¬ ì™„ë£Œ!

# ëŒ€í™”í˜• ì§ˆì˜ì‘ë‹µ
$ python -m app.domain.rag.cli query

ì§ˆë¬¸> íšŒì‚¬ì˜ ë¹„ì „ì€?

ë‹µë³€
[ë¬¸ì„œ 1]ì— ë”°ë¥´ë©´, íšŒì‚¬ì˜ ë¹„ì „ì€ "AI ê¸°ìˆ ë¡œ 
ì„¸ìƒì„ ë” ë‚˜ì€ ê³³ìœ¼ë¡œ ë§Œë“ ë‹¤"ì…ë‹ˆë‹¤...

ì°¸ê³  ë¬¸ì„œ (3ê°œ):
  1. manual.pdf (í˜ì´ì§€ 5) - ìœ ì‚¬ë„: 0.87
  2. manual.pdf (í˜ì´ì§€ 12) - ìœ ì‚¬ë„: 0.82
  3. manual.pdf (í˜ì´ì§€ 8) - ìœ ì‚¬ë„: 0.78
```

## âš™ï¸ ì„¤ì •

`backend/app/domain/rag/config.py`:

```python
# ì²­í¬ ì„¤ì •
RAG_CHUNK_SIZE: int = 400
RAG_CHUNK_OVERLAP: int = 50

# ê²€ìƒ‰ ì„¤ì •
RAG_TOP_K: int = 3

# ëª¨ë¸ ì„¤ì •
KOREAN_EMBEDDING_MODEL = "jhgan/ko-sroberta-multitask"
OPENAI_MODEL = "gpt-4o"
OPENAI_TEMPERATURE = 0.7
```

## ğŸ”Œ API í†µí•© (ì„ íƒì‚¬í•­)

`backend/app/api/v1/router.py`ì— ì¶”ê°€:

```python
from app.api.v1.endpoints.rag import router as rag_router

api_router.include_router(
    rag_router,
    prefix="/rag",
    tags=["RAG"]
)
```

## âœ… ì„¤ê³„ ì›ì¹™

1. **ì™„ì „í•œ ë…ë¦½ì„±**: ê¸°ì¡´ íŒŒì¼ ì ˆëŒ€ ìˆ˜ì • ì•ˆ í•¨
2. **ëª¨ë“ˆí™”**: ê° ê¸°ëŠ¥ì´ ë…ë¦½ì ì¸ ëª¨ë“ˆë¡œ ë¶„ë¦¬
3. **í•œêµ­ì–´ ìµœì í™”**: KoSentenceBERT ì‚¬ìš©
4. **í™•ì¥ ê°€ëŠ¥ì„±**: ì‰½ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥
5. **ì‚¬ìš©ì ì¹œí™”ì **: CLIì™€ API ëª¨ë‘ ì œê³µ

## ğŸ“š ë¬¸ì„œ

- **RAG_README.md**: ì „ì²´ ì‹œìŠ¤í…œ ì„¤ëª…
- **RAG_INTEGRATION_GUIDE.md**: í†µí•© ê°€ì´ë“œ
- **USAGE_GUIDE.md**: ìƒì„¸ ì‚¬ìš©ë²•
- **rag_requirements.txt**: ì˜ì¡´ì„± ëª©ë¡

## ğŸ§ª í…ŒìŠ¤íŠ¸

```bash
# ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
python test_rag.py

# í…ŒìŠ¤íŠ¸ í•­ëª©:
# 1. ëª¨ë“ˆ Import
# 2. ì„¤ì • í™•ì¸
# 3. ì„ë² ë”© ëª¨ë¸
# 4. ë²¡í„° ì €ì¥ì†Œ
```

## âš ï¸ ì¤‘ìš” ì‚¬í•­

1. **OPENAI_API_KEY í•„ìˆ˜**: `.env` íŒŒì¼ì— ì„¤ì •
2. **ì²« ì‹¤í–‰ ì‹œ ëª¨ë¸ ë‹¤ìš´ë¡œë“œ**: ì•½ 500MB (KoSentenceBERT)
3. **ê¸°ì¡´ íŒŒì¼ ë¯¸ìˆ˜ì •**: ì™„ì „íˆ ìƒˆë¡œìš´ íŒŒì¼ë§Œ ìƒì„±
4. **API ì—°ë™ ì„ íƒ**: ì‚¬ìš©ìê°€ ì›í•  ë•Œë§Œ ë¼ìš°í„° ë“±ë¡

## ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ëª©ë¡

```txt
PyMuPDF>=1.23.0              # PDF ì²˜ë¦¬
pdfplumber>=0.10.0           # í‘œ ì¶”ì¶œ
sentence-transformers>=2.2.0  # ì„ë² ë”©
langchain>=0.1.0             # ë¬¸ì„œ ë³€í™˜
langchain-community>=0.0.10   # LangChain ì»¤ë®¤ë‹ˆí‹°
langchain-text-splitters>=0.0.1  # í…ìŠ¤íŠ¸ ë¶„í• 
Pillow>=10.0.0               # ì´ë¯¸ì§€ ì²˜ë¦¬
rich>=13.9.4                 # CLI UI
```

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. âœ… **ì„¤ì¹˜**: `pip install -r rag_requirements.txt`
2. âœ… **í™˜ê²½ë³€ìˆ˜**: `.env`ì— `OPENAI_API_KEY` ì¶”ê°€
3. âœ… **í…ŒìŠ¤íŠ¸**: `python test_rag.py`
4. âœ… **PDF ì—…ë¡œë“œ**: `python -m app.domain.rag.cli upload <pdf>`
5. âœ… **ì§ˆì˜ì‘ë‹µ**: `python -m app.domain.rag.cli query`
6. (ì„ íƒ) **API í†µí•©**: ë¼ìš°í„° ë“±ë¡

## ğŸš€ ì‹¤í–‰ ì¤€ë¹„ ì™„ë£Œ!

ëª¨ë“  íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ì‹œì‘í•˜ì„¸ìš”:

```bash
cd Virtual-Assistant/backend
pip install -r rag_requirements.txt
python test_rag.py

```

ì—…ë¡œë“œ - python -m app.domain.rag.cli upload internal_docs/uploads
ì±—ë´‡ í™œì„±í™” - python -m app.domain.rag.cli query

ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ë¬¸ì˜í•˜ì„¸ìš”! ğŸ‰

