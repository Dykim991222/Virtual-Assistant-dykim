# ì‹œê°„ ë³µì¡ë„ ë¶„ì„ ë° ê°œì„  ë°©ì•ˆ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025.12.01  
**ëŒ€ìƒ íŒŒì¼**: `automatic_save.py`, `rag_therapy.py`  
**ëª©ì **: ì„±ëŠ¥ ë³‘ëª© êµ¬ê°„ ì‹ë³„ ë° ìµœì í™” ë°©ì•ˆ ì œì‹œ

---

## 1. ê°œìš”

ë³¸ ë³´ê³ ì„œëŠ” Virtual Assistant ì‹œìŠ¤í…œì˜ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ì¸ `automatic_save.py`ì™€ `rag_therapy.py`ì˜ ì‹œê°„ ë³µì¡ë„ë¥¼ ë¶„ì„í•˜ê³ , ì„±ëŠ¥ ê°œì„  ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤.

### 1.1 ë¶„ì„ ë²”ìœ„

- **automatic_save.py**: PDF ë¬¸ì„œ ì²˜ë¦¬, ì²­í‚¹, ì„ë² ë”© ìƒì„±, Vector DB ì €ì¥ íŒŒì´í”„ë¼ì¸
- **rag_therapy.py**: RAG ê¸°ë°˜ ìƒë‹´ ì‹œìŠ¤í…œ (ê²€ìƒ‰, ë‹µë³€ ìƒì„±)

### 1.2 ì£¼ìš” ì§€í‘œ

- **ì‹œê°„ ë³µì¡ë„**: ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰ ì‹œê°„ì˜ ì…ë ¥ í¬ê¸° ëŒ€ë¹„ ì¦ê°€ìœ¨
- **ê³µê°„ ë³µì¡ë„**: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
- **I/O ë¹„ìš©**: íŒŒì¼ ì½ê¸°/ì“°ê¸°, API í˜¸ì¶œ
- **ë„¤íŠ¸ì›Œí¬ ë¹„ìš©**: OpenAI API í˜¸ì¶œ

---

## 2. automatic_save.py ì‹œê°„ ë³µì¡ë„ ë¶„ì„

### 2.1 í˜„ì¬ êµ¬ì¡°

```
automatic_save.py (Orchestrator)
  â”œâ”€ step1_create_chunks() â†’ create_chunk_files.py
  â”œâ”€ step2_create_embeddings() â†’ create_openai_embeddings.py
  â””â”€ step3_save_to_vectordb() â†’ save_to_vectordb.py
```

### 2.2 ë‹¨ê³„ë³„ ì‹œê°„ ë³µì¡ë„ ë¶„ì„

#### 2.2.1 Step 1: ì²­í¬ íŒŒì¼ ìƒì„± (`create_chunk_files.py`)

**í˜„ì¬ ì‹œê°„ ë³µì¡ë„**: `O(f Ã— (p Ã— t + c Ã— t + j))`

- `f`: PDF íŒŒì¼ ê°œìˆ˜
- `p`: PDF í˜ì´ì§€ ìˆ˜ (í‰ê·  50-100í˜ì´ì§€)
- `t`: í† í° ê³„ì‚° ì‹œê°„ (í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë¹„ë¡€)
- `c`: ì²­í¬ ê°œìˆ˜ (Parent + Child)
- `j`: JSON ì €ì¥ ì‹œê°„

**ë³‘ëª© êµ¬ê°„**:
1. **PDF í…ìŠ¤íŠ¸ ì¶”ì¶œ** (`extract_text_from_pdf`): `O(p Ã— l)` - í˜ì´ì§€ë‹¹ í…ìŠ¤íŠ¸ ì¶”ì¶œ
2. **í…ìŠ¤íŠ¸ ì •ì œí™”** (`clean_pdf_text`): `O(l Ã— r)` - ì •ê·œì‹ íŒ¨í„´ ê°œìˆ˜(r) Ã— í…ìŠ¤íŠ¸ ê¸¸ì´(l)
3. **Parent-Child ì²­í‚¹** (`split_into_parents`, `split_parent_into_children`): `O(c Ã— t)` - ê° ì²­í¬ë§ˆë‹¤ í† í° ê³„ì‚°
4. **ìˆœì°¨ íŒŒì¼ ì²˜ë¦¬**: ê° íŒŒì¼ì„ í•˜ë‚˜ì”© ì²˜ë¦¬ (`O(f)`, ë³‘ë ¬ ì²˜ë¦¬ ì—†ìŒ)

**ê³µê°„ ë³µì¡ë„**: `O(l)` - ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œ

#### 2.2.2 Step 2: ì„ë² ë”© ìƒì„± (`create_openai_embeddings.py`)

**í˜„ì¬ ì‹œê°„ ë³µì¡ë„**: `O((c / B) Ã— A + c Ã— j)`

- `c`: ì „ì²´ ì²­í¬ ê°œìˆ˜
- `B`: ë°°ì¹˜ í¬ê¸° (í˜„ì¬ 100)
- `A`: API í˜¸ì¶œ ì‹œê°„ (ë„¤íŠ¸ì›Œí¬ ì§€ì—° í¬í•¨, ì•½ 2-5ì´ˆ)
- `j`: JSON ì €ì¥ ì‹œê°„

**ë³‘ëª© êµ¬ê°„**:
1. **ìˆœì°¨ ë°°ì¹˜ ì²˜ë¦¬**: ë°°ì¹˜ë¥¼ í•˜ë‚˜ì”© ì²˜ë¦¬í•˜ì—¬ ì „ì²´ ì‹œê°„ = `(c / B) Ã— A`
   - ì˜ˆ: 10,000ê°œ ì²­í¬, ë°°ì¹˜ 100 â†’ 100ë²ˆì˜ API í˜¸ì¶œ
   - ê° API í˜¸ì¶œë‹¹ 3ì´ˆ â†’ ì´ 300ì´ˆ (5ë¶„)
2. **íŒŒì¼ë³„ ìˆœì°¨ ì²˜ë¦¬**: ê° ì²­í¬ íŒŒì¼ì„ í•˜ë‚˜ì”© ì²˜ë¦¬ (ë³‘ë ¬í™” ì—†ìŒ)
3. **ë„¤íŠ¸ì›Œí¬ I/O ëŒ€ê¸°**: ë™ê¸°ì‹ API í˜¸ì¶œë¡œ ëŒ€ê¸° ì‹œê°„ ë°œìƒ

**ê³µê°„ ë³µì¡ë„**: `O(B Ã— e)` - ë°°ì¹˜ í¬ê¸° Ã— ì„ë² ë”© ë²¡í„° í¬ê¸° (3072ì°¨ì›)

#### 2.2.3 Step 3: Vector DB ì €ì¥ (`save_to_vectordb.py`)

**í˜„ì¬ ì‹œê°„ ë³µì¡ë„**: `O(f Ã— j + (c / B_v) Ã— D)`

- `f`: ì„ë² ë”© íŒŒì¼ ê°œìˆ˜
- `j`: JSON ë¡œë“œ ì‹œê°„
- `c`: ì „ì²´ ì²­í¬ ê°œìˆ˜
- `B_v`: Vector DB ë°°ì¹˜ í¬ê¸° (í˜„ì¬ 1000)
- `D`: Vector DB ì‚½ì… ì‹œê°„

**ë³‘ëª© êµ¬ê°„**:
1. **ëª¨ë“  íŒŒì¼ ë©”ëª¨ë¦¬ ë¡œë“œ**: ëª¨ë“  ì„ë² ë”© íŒŒì¼ì„ ë©”ëª¨ë¦¬ì— ë¡œë“œ (`O(f Ã— c/f Ã— m)` = `O(c Ã— m)`)
2. **ì¤‘ë³µ ID í™•ì¸**: ê¸°ì¡´ ID ì „ì²´ ì¡°íšŒ (`O(c_existing)`), ê° IDë§ˆë‹¤ set ì¡°íšŒ (`O(1)`)
3. **ë°°ì¹˜ ì €ì¥**: ìˆœì°¨ì  ë°°ì¹˜ ì €ì¥ (ë³‘ë ¬í™” ì—†ìŒ)

**ê³µê°„ ë³µì¡ë„**: `O(c Ã— m)` - ëª¨ë“  ì²­í¬ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥

### 2.3 ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹œê°„ ë³µì¡ë„

**í˜„ì¬**: `O(f Ã— (p Ã— t + c Ã— t + j) + (c / B) Ã— A + c Ã— j + (c / B_v) Ã— D)`

**ì‹¤ì œ ì‹¤í–‰ ì‹œê°„ ì¶”ì •** (íŒŒì¼ 20ê°œ, ì²­í¬ 10,000ê°œ ê¸°ì¤€):
- ì²­í¬ ìƒì„±: ~30ë¶„
- ì„ë² ë”© ìƒì„±: ~5ë¶„ (API ë³‘ëª©)
- Vector DB ì €ì¥: ~2ë¶„
- **ì´ ì‹¤í–‰ ì‹œê°„**: ~37ë¶„

---

## 3. rag_therapy.py ì‹œê°„ ë³µì¡ë„ ë¶„ì„

### 3.1 í˜„ì¬ êµ¬ì¡°

```
rag_therapy.py (Main Controller)
  â”œâ”€ PersonaManager (í˜ë¥´ì†Œë‚˜ ìƒì„±)
  â”œâ”€ SearchEngine (ê²€ìƒ‰ ë° ìœ ì‚¬ë„ ê³„ì‚°)
  â””â”€ ResponseGenerator (ë‹µë³€ ìƒì„±)
```

### 3.2 ì‹œê°„ ë³µì¡ë„ ë¶„ì„ (ì£¼ì„ ê¸°ì¤€: `O(i * q * n + k + n + h)`)

**ì£¼ì„ì˜ ì‹œê°„ ë³µì¡ë„ í•´ì„**:
- `i`: ë°˜ë³µ ê²€ìƒ‰ íšŸìˆ˜ (í˜„ì¬ ìµœëŒ€ 2íšŒ)
- `q`: ì¿¼ë¦¬ í™•ì¥ ê°œìˆ˜ (í‰ê·  3-5ê°œ)
- `n`: Vector DBì˜ ì´ ë¬¸ì„œ ìˆ˜
- `k`: ê²€ìƒ‰ëœ ì²­í¬ ê°œìˆ˜ (ìƒìœ„ 5ê°œ)
- `h`: ëŒ€í™” íˆìŠ¤í† ë¦¬ ê¸¸ì´ (ìµœëŒ€ 10ê°œ)

**ì‹¤ì œ ë¶„ì„ ê²°ê³¼**: `O(i Ã— (E + T + q Ã— (E + S)) + k Ã— (R + LLM) + LLM_final)`

- `E`: ì„ë² ë”© ìƒì„± ì‹œê°„ (API í˜¸ì¶œ, ~0.5ì´ˆ)
- `T`: ë²ˆì—­ ì‹œê°„ (API í˜¸ì¶œ, ~1ì´ˆ)
- `S`: Vector DB ê²€ìƒ‰ ì‹œê°„ (`O(log n)` - HNSW ì¸ë±ìŠ¤)
- `R`: Re-ranker ì‹¤í–‰ ì‹œê°„ (LLM í˜¸ì¶œ, ~2ì´ˆ)
- `LLM`: ë‹µë³€ ìƒì„± ì‹œê°„ (API í˜¸ì¶œ, ~3ì´ˆ)
- `LLM_final`: ìµœì¢… ë‹µë³€ ìƒì„± (API í˜¸ì¶œ, ~3ì´ˆ)

### 3.3 ë‹¨ê³„ë³„ ìƒì„¸ ë¶„ì„

#### 3.3.1 ì…ë ¥ ì²˜ë¦¬ ë° ë²ˆì—­

**ì‹œê°„ ë³µì¡ë„**: `O(T)` - ë‹¨ì¼ API í˜¸ì¶œ

```python
# rag_therapy.py:314
english_input = self.search_engine.translate_to_english(user_input)
```

**ë¬¸ì œì **: ë§¤ ìš”ì²­ë§ˆë‹¤ ë²ˆì—­ API í˜¸ì¶œ â†’ í‰ê·  1ì´ˆ ì§€ì—°

#### 3.3.2 Multi-step ë°˜ë³µ ê²€ìƒ‰ (`_iterative_search_with_query_expansion`)

**ì‹œê°„ ë³µì¡ë„**: `O(i Ã— (E + S + q Ã— (E + S)))`

**ìµœì•…ì˜ ê²½ìš°** (2íšŒ ë°˜ë³µ, 5ê°œ ì¿¼ë¦¬ í™•ì¥):
1. **ì´ˆê¸° ê²€ìƒ‰**: ì„ë² ë”© ìƒì„± (`E`) + Vector DB ê²€ìƒ‰ (`S`) = ~0.6ì´ˆ
2. **ì¿¼ë¦¬ í™•ì¥**: LLM í˜¸ì¶œ (`~2ì´ˆ`) + 5ê°œ ê²€ìƒ‰ì–´ ìƒì„±
3. **ì¬ê²€ìƒ‰**: 5ê°œ ì¿¼ë¦¬ Ã— (ì„ë² ë”© + ê²€ìƒ‰) = 5 Ã— (~0.6ì´ˆ) = ~3ì´ˆ
4. **í’ˆì§ˆ í‰ê°€**: `O(k)` - ê²€ìƒ‰ëœ ì²­í¬ í‰ê°€ (~0.01ì´ˆ)

**ì´ ì‹œê°„**: ~5-6ì´ˆ

**ë³‘ëª© êµ¬ê°„**:
1. **ìˆœì°¨ API í˜¸ì¶œ**: ì„ë² ë”© ìƒì„±, ë²ˆì—­, ì¿¼ë¦¬ í™•ì¥ì´ ëª¨ë‘ ìˆœì°¨ ì‹¤í–‰
2. **ë¶ˆí•„ìš”í•œ ì¬ê²€ìƒ‰**: í’ˆì§ˆì´ ì´ë¯¸ ì¶©ë¶„í•œë°ë„ ë°˜ë³µ ê²€ìƒ‰ ê°€ëŠ¥
3. **ì¿¼ë¦¬ í™•ì¥ ë¹„ìš©**: LLM í˜¸ì¶œì´ ì¶”ê°€ë˜ëŠ”ë° ì‹¤ì œ ê°œì„  íš¨ê³¼ê°€ ë‚®ì„ ìˆ˜ ìˆìŒ

#### 3.3.3 Re-ranker (`rerank_chunks`)

**ì‹œê°„ ë³µì¡ë„**: `O(k Ã— LLM_r)` - LLM í˜¸ì¶œ 1íšŒ

**í˜„ì¬**: ê²€ìƒ‰ëœ 5ê°œ ì²­í¬ë¥¼ LLMìœ¼ë¡œ ì¬ì •ë ¬ â†’ ~2ì´ˆ

**ë¬¸ì œì **: 
- ëª¨ë“  ê²€ìƒ‰ ê²°ê³¼ì— ëŒ€í•´ ì¬ì •ë ¬ (ì‹¤ì œë¡œëŠ” ìƒìœ„ 2-3ê°œë§Œ í•„ìš”í•  ìˆ˜ ìˆìŒ)
- LLM í˜¸ì¶œë¡œ ì¸í•œ ì§€ì—°

#### 3.3.4 ë‹µë³€ ìƒì„± (`generate_response_with_persona`)

**ì‹œê°„ ë³µì¡ë„**: `O(LLM_final)` - ë‹¨ì¼ API í˜¸ì¶œ

**í˜„ì¬**: 
- ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±: `O(k)` - ìƒìœ„ 3ê°œ ì²­í¬
- LLM í˜¸ì¶œ: ~3ì´ˆ

**ì´ ì‘ë‹µ ì‹œê°„**: ~10-12ì´ˆ (ë²ˆì—­ 1ì´ˆ + ê²€ìƒ‰ 6ì´ˆ + ì¬ì •ë ¬ 2ì´ˆ + ë‹µë³€ 3ì´ˆ)

### 3.4 PersonaManager ì‹œê°„ ë³µì¡ë„

**ì´ˆê¸°í™” ì‹œ**:
- ìºì‹œ ë¡œë“œ: `O(1)` - íŒŒì¼ ì½ê¸°
- RAG í˜ë¥´ì†Œë‚˜ ìƒì„± (ë°±ê·¸ë¼ìš´ë“œ): `O(6 Ã— (E + S) + LLM + LLM_persona)`
  - 6ê°œ ì¿¼ë¦¬ ê²€ìƒ‰ + ì›¹ ê²€ìƒ‰(LLM) + í˜ë¥´ì†Œë‚˜ ìƒì„±(LLM)
  - ì´ ~15-20ì´ˆ (ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰)

**ë¬¸ì œì  ì—†ìŒ**: ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ìœ¼ë¡œ ì‚¬ìš©ì ê²½í—˜ì— ì˜í–¥ ì—†ìŒ

---

## 4. ì£¼ìš” ë³‘ëª© êµ¬ê°„ ì‹ë³„

### 4.1 automatic_save.py ë³‘ëª© êµ¬ê°„

#### ğŸ”´ **Critical (ì¦‰ì‹œ ê°œì„  í•„ìš”)**

1. **ìˆœì°¨ íŒŒì¼ ì²˜ë¦¬**
   - **í˜„ì¬**: ê° íŒŒì¼ì„ í•˜ë‚˜ì”© ìˆœì°¨ ì²˜ë¦¬
   - **ì˜í–¥**: íŒŒì¼ ê°œìˆ˜ê°€ ì¦ê°€í•˜ë©´ ì„ í˜•ì ìœ¼ë¡œ ì‹œê°„ ì¦ê°€
   - **ê°œì„  íš¨ê³¼**: ë³‘ë ¬ ì²˜ë¦¬ ì‹œ ì•½ 70-80% ì‹œê°„ ë‹¨ì¶• ì˜ˆìƒ

2. **ì„ë² ë”© ìƒì„± ìˆœì°¨ ë°°ì¹˜ ì²˜ë¦¬**
   - **í˜„ì¬**: ë°°ì¹˜ë¥¼ í•˜ë‚˜ì”© ìˆœì°¨ í˜¸ì¶œ
   - **ì˜í–¥**: 10,000ê°œ ì²­í¬ â†’ 100ë²ˆ API í˜¸ì¶œ Ã— 3ì´ˆ = 300ì´ˆ
   - **ê°œì„  íš¨ê³¼**: ë™ì‹œ ë°°ì¹˜ ì²˜ë¦¬ ì‹œ ì•½ 60-70% ì‹œê°„ ë‹¨ì¶• ì˜ˆìƒ

3. **ì „ì²´ ë°ì´í„° ë©”ëª¨ë¦¬ ë¡œë“œ**
   - **í˜„ì¬**: ëª¨ë“  ì„ë² ë”© íŒŒì¼ì„ ë©”ëª¨ë¦¬ì— ë¡œë“œ
   - **ì˜í–¥**: ë©”ëª¨ë¦¬ ë¶€ì¡± ê°€ëŠ¥ì„±, GC ì˜¤ë²„í—¤ë“œ
   - **ê°œì„  íš¨ê³¼**: ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ ì‹œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ 90% ê°ì†Œ

#### ğŸŸ¡ **Medium (ìš°ì„  ê°œì„ )**

4. **í…ìŠ¤íŠ¸ ì •ì œí™” ì •ê·œì‹ ë°˜ë³µ ì‹¤í–‰**
   - **í˜„ì¬**: ì—¬ëŸ¬ ì •ê·œì‹ì„ ìˆœì°¨ ì‹¤í–‰
   - **ì˜í–¥**: ê¸´ í…ìŠ¤íŠ¸ì—ì„œ ì‹œê°„ ì†Œëª¨
   - **ê°œì„  íš¨ê³¼**: ì •ê·œì‹ ë³‘í•©, ì»´íŒŒì¼ ìºì‹± ì‹œ ì•½ 20-30% ì‹œê°„ ë‹¨ì¶•

5. **ì¤‘ë³µ ID í™•ì¸ ë°©ì‹**
   - **í˜„ì¬**: ì „ì²´ ê¸°ì¡´ IDë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œ
   - **ì˜í–¥**: ëŒ€ìš©ëŸ‰ ë°ì´í„°ì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
   - **ê°œì„  íš¨ê³¼**: ìŠ¤íŠ¸ë¦¬ë° í™•ì¸ ë˜ëŠ” DB ì¿¼ë¦¬ ìµœì í™”

### 4.2 rag_therapy.py ë³‘ëª© êµ¬ê°„

#### ğŸ”´ **Critical (ì¦‰ì‹œ ê°œì„  í•„ìš”)**

1. **ìˆœì°¨ API í˜¸ì¶œ ì²´ì¸**
   - **í˜„ì¬**: ë²ˆì—­ â†’ ê²€ìƒ‰ â†’ ì¬ê²€ìƒ‰ì´ ëª¨ë‘ ìˆœì°¨ ì‹¤í–‰
   - **ì˜í–¥**: ê° API í˜¸ì¶œë§ˆë‹¤ ë„¤íŠ¸ì›Œí¬ ì§€ì—° ëˆ„ì 
   - **ê°œì„  íš¨ê³¼**: ë³‘ë ¬ ì²˜ë¦¬ ë˜ëŠ” ìºì‹± ì‹œ ì•½ 40-50% ì‹œê°„ ë‹¨ì¶•

2. **ë¶ˆí•„ìš”í•œ ì¬ê²€ìƒ‰**
   - **í˜„ì¬**: í’ˆì§ˆì´ ì´ë¯¸ ì¶©ë¶„í•´ë„ ì¬ê²€ìƒ‰ ì‹œë„
   - **ì˜í–¥**: ì´ˆê¸° ê²€ìƒ‰ ê²°ê³¼ê°€ ì¢‹ì•„ë„ ì¶”ê°€ 3-5ì´ˆ ì†Œìš”
   - **ê°œì„  íš¨ê³¼**: ì¡°ê¸° ì¢…ë£Œ ì¡°ê±´ ê°•í™” ì‹œ ì•½ 30% ì‹œê°„ ë‹¨ì¶•

3. **Re-ranker ì‹¤í–‰ ë¹„ìš©**
   - **í˜„ì¬**: ëª¨ë“  ê²€ìƒ‰ ê²°ê³¼ì— ëŒ€í•´ LLM ì¬ì •ë ¬
   - **ì˜í–¥**: ì¶”ê°€ 2ì´ˆ ì§€ì—°
   - **ê°œì„  íš¨ê³¼**: ìƒìœ„ ê²°ê³¼ë§Œ ì¬ì •ë ¬ ë˜ëŠ” ì¡°ê±´ë¶€ ì‹¤í–‰ ì‹œ ì•½ 50% ì‹œê°„ ë‹¨ì¶•

#### ğŸŸ¡ **Medium (ìš°ì„  ê°œì„ )**

4. **ë²ˆì—­ API í˜¸ì¶œ**
   - **í˜„ì¬**: ë§¤ ìš”ì²­ë§ˆë‹¤ ë²ˆì—­
   - **ì˜í–¥**: 1ì´ˆ ì§€ì—°
   - **ê°œì„  íš¨ê³¼**: ìºì‹± ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë²ˆì—­ìœ¼ë¡œ ì•½ 90% ì‹œê°„ ë‹¨ì¶•

5. **ì¿¼ë¦¬ í™•ì¥ ë¹„ìš© ëŒ€ë¹„ íš¨ê³¼ ë‚®ìŒ**
   - **í˜„ì¬**: LLM í˜¸ì¶œë¡œ ì¿¼ë¦¬ í™•ì¥ í›„ ì¬ê²€ìƒ‰
   - **ì˜í–¥**: 5-6ì´ˆ ì†Œìš”, í’ˆì§ˆ ê°œì„  íš¨ê³¼ ë¶ˆí™•ì‹¤
   - **ê°œì„  íš¨ê³¼**: ì¡°ê±´ë¶€ ì‹¤í–‰ ë˜ëŠ” ê°„ë‹¨í•œ í‚¤ì›Œë“œ í™•ì¥ìœ¼ë¡œ ì‹œê°„ ë‹¨ì¶•

---

## 5. ê°œì„  ë°©ì•ˆ

### 5.1 automatic_save.py ê°œì„  ë°©ì•ˆ

#### 5.1.1 ë³‘ë ¬ íŒŒì¼ ì²˜ë¦¬ (Critical)

**ëª©í‘œ**: ì—¬ëŸ¬ PDF íŒŒì¼ì„ ë™ì‹œì— ì²˜ë¦¬

**ë°©ë²•**:
```python
from concurrent.futures import ProcessPoolExecutor, ThreadPoolExecutor
import multiprocessing

def process_files_parallel(files, max_workers=None):
    """ë³‘ë ¬ íŒŒì¼ ì²˜ë¦¬"""
    max_workers = max_workers or min(len(files), multiprocessing.cpu_count())
    
    with ProcessPoolExecutor(max_workers=max_workers) as executor:
        futures = [executor.submit(process_single_file, file) for file in files]
        results = [f.result() for f in futures]
    
    return results
```

**ì˜ˆìƒ íš¨ê³¼**:
- íŒŒì¼ 20ê°œ, CPU 8ì½”ì–´ â†’ ì•½ 70% ì‹œê°„ ë‹¨ì¶• (30ë¶„ â†’ 9ë¶„)
- **ì‹œê°„ ë³µì¡ë„**: `O(f Ã— (p Ã— t + c Ã— t + j) / w)` - wëŠ” ì›Œì»¤ ìˆ˜

**ì£¼ì˜ì‚¬í•­**:
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€ (ì›Œì»¤ ìˆ˜ë§Œí¼)
- I/O ì§‘ì•½ì  ì‘ì—…ì´ë¯€ë¡œ ThreadPoolExecutor ê³ ë ¤

#### 5.1.2 ë¹„ë™ê¸° ì„ë² ë”© ìƒì„± (Critical)

**ëª©í‘œ**: ì—¬ëŸ¬ ë°°ì¹˜ë¥¼ ë™ì‹œì— ì²˜ë¦¬

**ë°©ë²•**:
```python
import asyncio
from openai import AsyncOpenAI

async def create_embeddings_async(chunks, model_name, batch_size=100, max_concurrent=5):
    """ë¹„ë™ê¸° ë°°ì¹˜ ì„ë² ë”© ìƒì„±"""
    client = AsyncOpenAI(api_key=api_key)
    semaphore = asyncio.Semaphore(max_concurrent)
    
    async def process_batch(batch_texts):
        async with semaphore:
            response = await client.embeddings.create(
                input=batch_texts,
                model=model_name
            )
            return [item.embedding for item in response.data]
    
    batches = [chunks[i:i+batch_size] for i in range(0, len(chunks), batch_size)]
    tasks = [process_batch(batch) for batch in batches]
    results = await asyncio.gather(*tasks)
    
    return [emb for batch_embs in results for emb in batch_embs]
```

**ì˜ˆìƒ íš¨ê³¼**:
- ë™ì‹œ ë°°ì¹˜ 5ê°œ ì²˜ë¦¬ â†’ ì•½ 60% ì‹œê°„ ë‹¨ì¶• (5ë¶„ â†’ 2ë¶„)
- **ì‹œê°„ ë³µì¡ë„**: `O((c / B) Ã— A / max_concurrent)`

**ì£¼ì˜ì‚¬í•­**:
- OpenAI API Rate Limit ê³ ë ¤ (í˜„ì¬ 3,000 RPM)
- ë™ì‹œ ìš”ì²­ ìˆ˜ ì œí•œ í•„ìš” (Semaphore ì‚¬ìš©)

#### 5.1.3 ìŠ¤íŠ¸ë¦¬ë° Vector DB ì €ì¥ (Critical)

**ëª©í‘œ**: íŒŒì¼ì„ í•˜ë‚˜ì”© ì²˜ë¦¬í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì†Œ

**ë°©ë²•**:
```python
def save_to_vectordb_streaming(embedding_files, collection, batch_size=1000):
    """ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ìœ¼ë¡œ Vector DB ì €ì¥"""
    existing_ids = load_existing_ids(collection)  # í•œ ë²ˆë§Œ ë¡œë“œ
    
    for emb_file in embedding_files:
        data = load_embedding_file(emb_file)
        
        # ì¤‘ë³µ ì œê±°
        new_data = [item for item in data if item['id'] not in existing_ids]
        
        # ë°°ì¹˜ ì €ì¥
        for i in range(0, len(new_data), batch_size):
            batch = new_data[i:i+batch_size]
            collection.add(...)
            existing_ids.update([item['id'] for item in batch])
```

**ì˜ˆìƒ íš¨ê³¼**:
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ 90% ê°ì†Œ
- ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ê°€ëŠ¥

#### 5.1.4 ì •ê·œì‹ ìµœì í™” (Medium)

**ë°©ë²•**:
```python
import re

class TextCleaner:
    def __init__(self):
        # ì •ê·œì‹ ì»´íŒŒì¼ ë° ìºì‹±
        self.patterns = {
            'page_number': re.compile(r'^\s*\d+\s*$', re.MULTILINE),
            'url': re.compile(r'http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+'),
            # ... ê¸°íƒ€ íŒ¨í„´
        }
    
    def clean(self, text):
        for name, pattern in self.patterns.items():
            text = pattern.sub('', text)
        return text
```

**ì˜ˆìƒ íš¨ê³¼**: ì•½ 20-30% ì‹œê°„ ë‹¨ì¶•

### 5.2 rag_therapy.py ê°œì„  ë°©ì•ˆ

#### 5.2.1 ë²ˆì—­ ìºì‹± (Critical)

**ëª©í‘œ**: ë™ì¼í•œ ì…ë ¥ì— ëŒ€í•´ ë²ˆì—­ ê²°ê³¼ ìºì‹±

**ë°©ë²•**:
```python
from functools import lru_cache
import hashlib

class TranslationCache:
    def __init__(self, max_size=1000):
        self.cache = {}
        self.max_size = max_size
    
    def get_translation(self, text):
        text_hash = hashlib.md5(text.encode()).hexdigest()
        
        if text_hash in self.cache:
            return self.cache[text_hash]
        
        # ë²ˆì—­ ì‹¤í–‰
        translation = translate_to_english(text)
        
        # ìºì‹œ ì €ì¥ (LRU)
        if len(self.cache) >= self.max_size:
            self.cache.pop(next(iter(self.cache)))
        self.cache[text_hash] = translation
        
        return translation
```

**ì˜ˆìƒ íš¨ê³¼**: ìºì‹œ íˆíŠ¸ìœ¨ 50% ê°€ì • ì‹œ ì•½ 45% ì‹œê°„ ë‹¨ì¶• (1ì´ˆ â†’ 0.55ì´ˆ)

#### 5.2.2 ì¡°ê¸° ì¢…ë£Œ ì¡°ê±´ ê°•í™” (Critical)

**ëª©í‘œ**: í’ˆì§ˆì´ ì¶©ë¶„í•˜ë©´ ì¬ê²€ìƒ‰ ì¤‘ë‹¨

**ë°©ë²•**:
```python
def _iterative_search_with_query_expansion(self, user_input, max_iterations=2, n_results=5):
    # ì´ˆê¸° ê²€ìƒ‰
    initial_chunks = self.retrieve_chunks(user_input, n_results=n_results)
    quality_info = self._evaluate_search_quality(initial_chunks)
    
    # ì¡°ê¸° ì¢…ë£Œ: í‰ê·  ìœ ì‚¬ë„ê°€ ë†’ìœ¼ë©´ ë°”ë¡œ ë°˜í™˜
    if quality_info['avg_similarity'] >= 0.75:  # ë†’ì€ ì„ê³„ê°’
        print(f"[ì •ë³´] ì´ˆê¸° ê²€ìƒ‰ í’ˆì§ˆì´ ìš°ìˆ˜í•˜ì—¬ ì¬ê²€ìƒ‰ ê±´ë„ˆëœ€")
        return {
            "chunks": initial_chunks,
            "quality_info": quality_info,
            "iterations_used": 1
        }
    
    # ê¸°ì¡´ ë¡œì§...
```

**ì˜ˆìƒ íš¨ê³¼**: ì•½ 30% ì¿¼ë¦¬ì—ì„œ ì¬ê²€ìƒ‰ ìƒëµ â†’ í‰ê·  1-2ì´ˆ ì‹œê°„ ë‹¨ì¶•

#### 5.2.3 ì¡°ê±´ë¶€ Re-ranker ì‹¤í–‰ (Critical)

**ëª©í‘œ**: ìœ ì‚¬ë„ê°€ ë†’ìœ¼ë©´ Re-ranker ìƒëµ

**ë°©ë²•**:
```python
def retrieve_chunks(self, user_input, n_results=5, use_reranker=True):
    # ê²€ìƒ‰
    retrieved_chunks = self._hybrid_search(user_input, n_results=n_results)
    
    # ìµœê³  ìœ ì‚¬ë„ í™•ì¸
    max_similarity = max(chunk.get('final_similarity', 0) for chunk in retrieved_chunks)
    
    # ìœ ì‚¬ë„ê°€ ë†’ìœ¼ë©´ Re-ranker ìƒëµ
    if use_reranker and max_similarity < 0.8:  # ì„ê³„ê°’ ì„¤ì •
        retrieved_chunks = self.rerank_chunks(user_input, retrieved_chunks)
    
    return retrieved_chunks
```

**ì˜ˆìƒ íš¨ê³¼**: ì•½ 50% ì¿¼ë¦¬ì—ì„œ Re-ranker ìƒëµ â†’ í‰ê·  1ì´ˆ ì‹œê°„ ë‹¨ì¶•

#### 5.2.4 ë³‘ë ¬ API í˜¸ì¶œ (Critical)

**ëª©í‘œ**: ë²ˆì—­ê³¼ ì´ˆê¸° ê²€ìƒ‰ì„ ë³‘ë ¬ ì‹¤í–‰

**ë°©ë²•**:
```python
import asyncio

async def process_query_parallel(user_input):
    # ë²ˆì—­ê³¼ ì´ˆê¸° ì„ë² ë”© ìƒì„± ë³‘ë ¬ ì‹¤í–‰
    translation_task = asyncio.create_task(translate_to_english_async(user_input))
    embedding_task = asyncio.create_task(create_query_embedding_async(user_input))
    
    english_input, query_embedding = await asyncio.gather(
        translation_task, embedding_task
    )
    
    # ê²€ìƒ‰ ì‹¤í–‰
    results = await search_async(query_embedding)
    return results
```

**ì˜ˆìƒ íš¨ê³¼**: ë²ˆì—­ê³¼ ì„ë² ë”© ë³‘ë ¬ ì²˜ë¦¬ â†’ ì•½ 1ì´ˆ ì‹œê°„ ë‹¨ì¶•

#### 5.2.5 ì¿¼ë¦¬ í™•ì¥ ìµœì í™” (Medium)

**ë°©ë²•**:
1. **ê°„ë‹¨í•œ í‚¤ì›Œë“œ í™•ì¥**: LLM ëŒ€ì‹  ê°„ë‹¨í•œ ë™ì˜ì–´ ì‚¬ì „ ì‚¬ìš©
2. **ì¡°ê±´ë¶€ í™•ì¥**: ì´ˆê¸° ê²€ìƒ‰ í’ˆì§ˆì´ ë§¤ìš° ë‚®ì„ ë•Œë§Œ í™•ì¥

**ì˜ˆìƒ íš¨ê³¼**: ì•½ 2-3ì´ˆ ì‹œê°„ ë‹¨ì¶• (ì¡°ê±´ë¶€ ì‹¤í–‰ ì‹œ)

---

## 6. ìš°ì„ ìˆœìœ„ë³„ ê°œì„  ê³„íš

### 6.1 Phase 1: ì¦‰ì‹œ ê°œì„  (1-2ì£¼)

**ëª©í‘œ**: ì‘ë‹µ ì‹œê°„ 40-50% ë‹¨ì¶•

1. âœ… **rag_therapy.py ë²ˆì—­ ìºì‹±**
   - êµ¬í˜„ ë‚œì´ë„: ë‚®ìŒ
   - ì˜ˆìƒ íš¨ê³¼: í‰ê·  0.5ì´ˆ ë‹¨ì¶•
   - ì‘ì—… ì‹œê°„: 2-3ì‹œê°„

2. âœ… **rag_therapy.py ì¡°ê¸° ì¢…ë£Œ ì¡°ê±´ ê°•í™”**
   - êµ¬í˜„ ë‚œì´ë„: ë‚®ìŒ
   - ì˜ˆìƒ íš¨ê³¼: í‰ê·  1-2ì´ˆ ë‹¨ì¶•
   - ì‘ì—… ì‹œê°„: 1-2ì‹œê°„

3. âœ… **rag_therapy.py ì¡°ê±´ë¶€ Re-ranker**
   - êµ¬í˜„ ë‚œì´ë„: ë‚®ìŒ
   - ì˜ˆìƒ íš¨ê³¼: í‰ê·  1ì´ˆ ë‹¨ì¶•
   - ì‘ì—… ì‹œê°„: 1-2ì‹œê°„

**Phase 1 ì´ ì˜ˆìƒ íš¨ê³¼**: í‰ê·  ì‘ë‹µ ì‹œê°„ 10-12ì´ˆ â†’ 7-9ì´ˆ (ì•½ 30% ë‹¨ì¶•)

### 6.2 Phase 2: ì¤‘ê¸° ê°œì„  (2-4ì£¼)

**ëª©í‘œ**: ìë™ ì €ì¥ ì‹œê°„ 60-70% ë‹¨ì¶•

1. âœ… **automatic_save.py ë³‘ë ¬ íŒŒì¼ ì²˜ë¦¬**
   - êµ¬í˜„ ë‚œì´ë„: ì¤‘ê°„
   - ì˜ˆìƒ íš¨ê³¼: ì²­í¬ ìƒì„± ì‹œê°„ 70% ë‹¨ì¶• (30ë¶„ â†’ 9ë¶„)
   - ì‘ì—… ì‹œê°„: 1-2ì¼

2. âœ… **automatic_save.py ë¹„ë™ê¸° ì„ë² ë”© ìƒì„±**
   - êµ¬í˜„ ë‚œì´ë„: ì¤‘ê°„
   - ì˜ˆìƒ íš¨ê³¼: ì„ë² ë”© ìƒì„± ì‹œê°„ 60% ë‹¨ì¶• (5ë¶„ â†’ 2ë¶„)
   - ì‘ì—… ì‹œê°„: 2-3ì¼

3. âœ… **automatic_save.py ìŠ¤íŠ¸ë¦¬ë° Vector DB ì €ì¥**
   - êµ¬í˜„ ë‚œì´ë„: ì¤‘ê°„
   - ì˜ˆìƒ íš¨ê³¼: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ 90% ê°ì†Œ
   - ì‘ì—… ì‹œê°„: 1-2ì¼

**Phase 2 ì´ ì˜ˆìƒ íš¨ê³¼**: ì „ì²´ ìë™ ì €ì¥ ì‹œê°„ 37ë¶„ â†’ 12ë¶„ (ì•½ 68% ë‹¨ì¶•)

### 6.3 Phase 3: ì¥ê¸° ê°œì„  (1-2ê°œì›”)

**ëª©í‘œ**: ì¶”ê°€ ìµœì í™” ë° í™•ì¥ì„± í™•ë³´

1. âœ… **rag_therapy.py ë³‘ë ¬ API í˜¸ì¶œ**
   - êµ¬í˜„ ë‚œì´ë„: ë†’ìŒ
   - ì˜ˆìƒ íš¨ê³¼: í‰ê·  1ì´ˆ ë‹¨ì¶•
   - ì‘ì—… ì‹œê°„: 3-5ì¼

2. âœ… **ì¿¼ë¦¬ í™•ì¥ ìµœì í™”**
   - êµ¬í˜„ ë‚œì´ë„: ì¤‘ê°„
   - ì˜ˆìƒ íš¨ê³¼: ì¡°ê±´ë¶€ ì‹¤í–‰ìœ¼ë¡œ 2-3ì´ˆ ë‹¨ì¶•
   - ì‘ì—… ì‹œê°„: 2-3ì¼

3. âœ… **ì •ê·œì‹ ìµœì í™”**
   - êµ¬í˜„ ë‚œì´ë„: ë‚®ìŒ
   - ì˜ˆìƒ íš¨ê³¼: ì²­í¬ ìƒì„± ì‹œê°„ 20-30% ë‹¨ì¶•
   - ì‘ì—… ì‹œê°„: 1ì¼

---

## 7. ì˜ˆìƒ ì„±ëŠ¥ ê°œì„  ê²°ê³¼

### 7.1 rag_therapy.py ê°œì„  ì „/í›„ ë¹„êµ

| ë‹¨ê³„ | ê°œì„  ì „ | Phase 1 í›„ | Phase 3 í›„ |
|------|---------|------------|------------|
| ë²ˆì—­ | 1.0ì´ˆ | 0.5ì´ˆ (ìºì‹±) | 0.1ì´ˆ (ë³‘ë ¬) |
| ê²€ìƒ‰ | 6.0ì´ˆ | 4.0ì´ˆ (ì¡°ê¸° ì¢…ë£Œ) | 3.0ì´ˆ (ë³‘ë ¬) |
| Re-ranker | 2.0ì´ˆ | 1.0ì´ˆ (ì¡°ê±´ë¶€) | 0.5ì´ˆ (ìµœì í™”) |
| ë‹µë³€ ìƒì„± | 3.0ì´ˆ | 3.0ì´ˆ | 3.0ì´ˆ |
| **ì´ ì‹œê°„** | **12.0ì´ˆ** | **8.5ì´ˆ** | **6.6ì´ˆ** |

**ê°œì„ ìœ¨**: ì•½ 45% ì‹œê°„ ë‹¨ì¶•

### 7.2 automatic_save.py ê°œì„  ì „/í›„ ë¹„êµ

| ë‹¨ê³„ | ê°œì„  ì „ | Phase 2 í›„ |
|------|---------|------------|
| ì²­í¬ ìƒì„± | 30ë¶„ | 9ë¶„ (ë³‘ë ¬) |
| ì„ë² ë”© ìƒì„± | 5ë¶„ | 2ë¶„ (ë¹„ë™ê¸°) |
| Vector DB ì €ì¥ | 2ë¶„ | 1ë¶„ (ìŠ¤íŠ¸ë¦¬ë°) |
| **ì´ ì‹œê°„** | **37ë¶„** | **12ë¶„** |

**ê°œì„ ìœ¨**: ì•½ 68% ì‹œê°„ ë‹¨ì¶•

---

## 8. êµ¬í˜„ ì‹œ ì£¼ì˜ì‚¬í•­

### 8.1 ë³‘ë ¬ ì²˜ë¦¬ ì£¼ì˜ì‚¬í•­

1. **ë©”ëª¨ë¦¬ ê´€ë¦¬**
   - ë³‘ë ¬ ì›Œì»¤ ìˆ˜ëŠ” ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ì— ë§ê²Œ ì¡°ì •
   - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ í•„ìˆ˜

2. **API Rate Limit**
   - OpenAI API Rate Limit ê³ ë ¤ (3,000 RPM)
   - ë™ì‹œ ìš”ì²­ ìˆ˜ ì œí•œ (Semaphore ì‚¬ìš©)

3. **ì—ëŸ¬ ì²˜ë¦¬**
   - ì¼ë¶€ ì›Œì»¤ ì‹¤íŒ¨ ì‹œ ì „ì²´ ì‘ì—… ì‹¤íŒ¨ ë°©ì§€
   - ì¬ì‹œë„ ë¡œì§ êµ¬í˜„

### 8.2 ìºì‹± ì£¼ì˜ì‚¬í•­

1. **ìºì‹œ ë¬´íš¨í™”**
   - ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œ ìºì‹œ ë¬´íš¨í™”
   - TTL(Time To Live) ì„¤ì •

2. **ë©”ëª¨ë¦¬ ê´€ë¦¬**
   - LRU ìºì‹œ ì‚¬ìš©
   - ìºì‹œ í¬ê¸° ì œí•œ

### 8.3 í…ŒìŠ¤íŠ¸ ê³„íš

1. **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: ê° ìµœì í™” ê¸°ëŠ¥ë³„ í…ŒìŠ¤íŠ¸
2. **í†µí•© í…ŒìŠ¤íŠ¸**: ì „ì²´ íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸
3. **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: ì‹¤ì œ ë°ì´í„°ë¡œ ì„±ëŠ¥ ì¸¡ì •
4. **ë¶€í•˜ í…ŒìŠ¤íŠ¸**: ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ ëŠ¥ë ¥ í…ŒìŠ¤íŠ¸

---

## 9. ê²°ë¡ 

### 9.1 í•µì‹¬ ë°œê²¬ì‚¬í•­

1. **automatic_save.py**: ìˆœì°¨ ì²˜ë¦¬ë¡œ ì¸í•œ ì‹œê°„ ë‚­ë¹„ê°€ ì£¼ìš” ë³‘ëª©
2. **rag_therapy.py**: ë¶ˆí•„ìš”í•œ API í˜¸ì¶œê³¼ ìˆœì°¨ ì‹¤í–‰ì´ ì£¼ìš” ë³‘ëª©

### 9.2 ê¶Œì¥ ì‚¬í•­

1. **ì¦‰ì‹œ ì‹¤í–‰**: Phase 1 ê°œì„ ì‚¬í•­ (ë‚®ì€ ë‚œì´ë„, ë†’ì€ íš¨ê³¼)
2. **ë‹¨ê³„ì  ê°œì„ **: Phase 2, 3 ìˆœì°¨ ì§„í–‰
3. **ì§€ì†ì  ëª¨ë‹ˆí„°ë§**: ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ë¶„ì„

### 9.3 ì˜ˆìƒ íš¨ê³¼

- **rag_therapy.py**: í‰ê·  ì‘ë‹µ ì‹œê°„ 45% ë‹¨ì¶• (12ì´ˆ â†’ 6.6ì´ˆ)
- **automatic_save.py**: ì „ì²´ ì‹¤í–‰ ì‹œê°„ 68% ë‹¨ì¶• (37ë¶„ â†’ 12ë¶„)
- **ì‚¬ìš©ì ê²½í—˜**: ìƒë‹¹í•œ ê°œì„  ì˜ˆìƒ

---

**ì‘ì„±ì**: AI Assistant  
**ê²€í†  í•„ìš”**: ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê²€í† , API Rate Limit í™•ì¸, ë©”ëª¨ë¦¬ ì œì•½ í™•ì¸

